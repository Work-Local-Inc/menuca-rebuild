(()=>{var e={};e.id=405,e.ids=[405],e.modules={5596:e=>{function webpackEmptyContext(e){var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}webpackEmptyContext.keys=()=>[],webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id=5596,e.exports=webpackEmptyContext},2885:e=>{"use strict";e.exports=require("@supabase/supabase-js")},145:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5828:e=>{"use strict";e.exports=require("uuid")},8378:(e,s,r)=>{"use strict";r.r(s),r.d(s,{config:()=>z,default:()=>h,routeModule:()=>S});var i={};r.r(i),r.d(i,{default:()=>handler});var a=r(1802),t=r(7153),n=r(6249),o=r(2885),c=r(5828);let l=require("path");var m=r.n(l);let p=r(5596)(m().join(process.cwd(),"scripts","legacy-platform-scraper.js")),d=r(5596)(m().join(process.cwd(),"scripts","tony-pizza-scraper.js")),u=(0,o.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,(process.env.SUPABASE_SERVICE_ROLE_KEY||"").replace(/\s/g,"")),g={restaurant:{name:"Xtreme Pizza Ottawa",cuisine:"Pizza",location:"Ottawa, ON"},categories:[{name:"Appetizers",items:[{name:"Xtreme Platter",description:"Comes with zucchini, chicken fingers, onion rings, fries and breaded shrimps.",prices:[19.99]},{name:"Cheese Sticks",description:"8 Pcs",prices:[12.99]},{name:"Jalapeno Slammers",description:"6 Pcs",prices:[13.99]},{name:"Garlic Bread",description:"Regular",prices:[6.99,7.99,8.99],sizes:["Regular","With Cheese","With Cheese and Bacon"]},{name:"Nachos",description:"Comes with green peppers, onions and green olives.",prices:[16.99]},{name:"Fries",description:"",prices:[6.99,8.99],sizes:["Small","Large"]}]},{name:"Pizza",items:[{name:"Plain Pizza",description:"",prices:[13.99,19.99,25.99,31.99],sizes:["Small","Medium","Large","X-Large"]},{name:"Margherita",description:"Fresh mozzarella, tomatoes, basil",prices:[15.99,22.99,29.99,36.99],sizes:["Small","Medium","Large","X-Large"]},{name:"Hawaiian",description:"Ham, pineapple",prices:[15.99,22.99,29.99,36.99],sizes:["Small","Medium","Large","X-Large"]},{name:"Canadian",description:"Pepperoni, mushrooms, bacon strips",prices:[16.99,24.49,31.99,39.49],sizes:["Small","Medium","Large","X-Large"]},{name:"Meat Lovers",description:"Pepperoni, ham, sausage, bacon strips",prices:[17.99,25.99,33.99,41.99],sizes:["Small","Medium","Large","X-Large"]},{name:"House Special Pizza",description:"Pepperoni, mushrooms, green peppers, onions, green olives, bacon strips",prices:[18.99,27.49,35.99,43.49],sizes:["Small","Medium","Large","X-Large"]}]},{name:"Wings",items:[{name:"Chicken Wings",description:"Served with choice of red hot, sweet heat, honey garlic, mild, medium, suicide sauce",prices:[14.99,27.99,36.99],sizes:["10 Pcs","20 Pcs","30 Pcs"]},{name:"Boneless Dippers",description:"Served with choice of sauces",prices:[16.99,29.99,38.99],sizes:["10 Pcs","20 Pcs","30 Pcs"]}]},{name:"Poutine",items:[{name:"Poutine",description:"With cheese curds and gravy",prices:[8.99,11.99],sizes:["Small","Large"]},{name:"Italian Poutine",description:"With mozzarella cheese and meat sauce",prices:[9.99,12.99],sizes:["Small","Large"]},{name:"Canadian Poutine",description:"Cheese curds, chicken, bacon and gravy",prices:[10.99,13.99],sizes:["Small","Large"]}]},{name:"Salads",items:[{name:"Garden Salad",description:"Lettuce, tomatoes, onions, green peppers and green olives",prices:[9.99,12.99],sizes:["Small","Large"]},{name:"Greek Salad",description:"Lettuce, tomatoes, onions, green peppers, black olives and feta cheese",prices:[12.99,15.99],sizes:["Small","Large"]},{name:"Caesar Salad",description:"Lettuce, croutons and bacon bits",prices:[10.99,13.99],sizes:["Small","Large"]},{name:"Chicken Caesar Salad",description:"Chicken breast, lettuce, croutons and bacon bits",prices:[13.99,16.99],sizes:["Small","Large"]}]},{name:"Pasta",items:[{name:"Spaghetti",description:"With meat sauce. Served with garlic bread.",prices:[14.99]},{name:"Lasagna",description:"Served with garlic bread.",prices:[15.99]},{name:"Chicken Parmigiana",description:"Served with garlic bread.",prices:[19.99]}]},{name:"Drinks",items:[{name:"Pepsi",description:"",prices:[1.5,2.99,4.5],sizes:["Can","591ml","2L"]},{name:"Diet Pepsi",description:"",prices:[1.5,2.99,4.5],sizes:["Can","591ml","2L"]},{name:"7 Up",description:"",prices:[1.5,2.99,4.5],sizes:["Can","591ml","2L"]}]}]};async function handler(e,s){if("POST"!==e.method)return s.status(405).json({success:!1,error:"Method not allowed"});try{let r;let{url:i,restaurant_id:a,restaurant_name:t}=e.body;if(!i||!a)return s.status(400).json({success:!1,error:"URL and restaurant_id are required"});console.log("\uD83D\uDD0D Importing menu from:",i),console.log("\uD83C\uDFEA For restaurant:",t);try{if(i.includes("tonys-pizza.ca")){console.log("\uD83C\uDF55 Using Tony's Pizza specialized scraper");let e=new d,s=await e.scrapeMenu(i);r=s}else{console.log("\uD83D\uDD77Ô∏è Using general legacy platform scraper");let e=new p,s=await e.scrapeMenu(i);r=s}}catch(e){console.warn("‚ö†Ô∏è Scraping failed, falling back to Xtreme Pizza data:",e.message),r=g}console.log(`üìä Using ${r.categories.length} categories`);let n=(0,c.v4)();console.log("\uD83D\uDCCA Step 1: Creating restaurant menu...");let{data:o,error:l}=await u.from("restaurant_menus").insert({id:n,restaurant_id:a,tenant_id:"default-tenant",name:"Main Menu",description:`Complete menu imported from ${i}`,is_active:!0,display_order:1}).select().single();if(l||!o)return console.error("‚ùå Menu creation error:",JSON.stringify(l,null,2)),s.status(500).json({success:!1,error:"Failed to create restaurant menu",details:l});console.log("‚úÖ Created restaurant menu:",o.id),console.log("\uD83D\uDCCA Step 2: Creating categories and items...");let m=0;for(let e=0;e<r.categories.length;e++){let s=r.categories[e],i=(0,c.v4)(),{data:a,error:t}=await u.from("menu_categories").insert({id:i,menu_id:o.id,name:s.name,description:`${s.name} selection`,display_order:e,is_active:!0}).select().single();if(t||!a){console.error(`‚ùå Category creation error for ${s.name}:`,JSON.stringify(t,null,2));continue}console.log(`‚úÖ Created category: ${s.name} with ID: ${a.id}`),console.log(`üì¶ Creating ${s.items.length} items for category: ${s.name}`);for(let e=0;e<s.items.length;e++){let r=s.items[e],i=Array.isArray(r.prices)?r.prices[0]:r.prices,t=(0,c.v4)();console.log(`üîç Attempting to create item: ${r.name} (${e+1}/${s.items.length})`),console.log(`üìä Item data: category_id=${a.id}, price=${i}, description="${r.description||""}"`);let n={id:t,category_id:a.id,name:r.name,description:r.description||"",price:i||0};console.log(`üöÄ Inserting item with data:`,JSON.stringify(n,null,2));let{data:o,error:l}=await u.from("menu_items").insert(n).select().single();l?(console.error(`‚ùå Item creation error for ${r.name}:`,JSON.stringify(l,null,2)),console.error(`‚ùå Failed item data was:`,JSON.stringify(n,null,2)),console.error(`‚ùå Category ID used: ${a.id}`),console.error(`‚ùå Menu ID in category: ${a.menu_id}`)):(console.log(`‚úÖ Created item: ${r.name} - $${i} (ID: ${o?.id})`),m++)}}return console.log(`‚úÖ Menu import completed: ${m} items created`),s.status(200).json({success:!0,categories:r.categories.length,items:m,restaurant_id:a,preview:r.categories.slice(0,5).map(e=>({name:e.name,items:e.items.length})),message:`Successfully imported ${m} menu items across ${r.categories.length} categories`})}catch(e){return console.error("Menu import error:",e),s.status(500).json({success:!1,error:"Failed to import menu",message:e instanceof Error?e.message:"Unknown error"})}}let h=(0,n.l)(i,"default"),z=(0,n.l)(i,"config"),S=new a.PagesAPIRouteModule({definition:{kind:t.x.PAGES_API,page:"/api/admin/import-legacy-menu",pathname:"/api/admin/import-legacy-menu",bundlePath:"",filename:""},userland:i})}};var s=require("../../../webpack-api-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),r=s.X(0,[222],()=>__webpack_exec__(8378));module.exports=r})();