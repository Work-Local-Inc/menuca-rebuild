"use strict";(()=>{var e={};e.id=405,e.ids=[405],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},1287:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5828:e=>{e.exports=require("uuid")},6932:(e,i,s)=>{s.r(i),s.d(i,{config:()=>g,default:()=>d,routeModule:()=>u});var r={};s.r(r),s.d(r,{default:()=>handler});var a=s(1802),n=s(7153),t=s(6249),o=s(2885),c=s(5828);let p={categories:[{name:"Daily Special",items:[{name:"Meal Deal",description:"Large pizza with 3 toppings, 12 wings, 6 Cheesy Garlic Breadsticks with Marinara sauce, large Caesar salad and 2 liter of pop",price:51.95,prices:[51.95]}]},{name:"Super Specials",items:[{name:"2 Small Pizza and Wings",description:"2 small pizza with 3 toppings, 24 wings, 4 pop",price:47,prices:[47]},{name:"2 Medium Pizza and Wings",description:"2 medium pizza with 3 toppings, 36 wings and 4 pop",price:58,prices:[58]},{name:"2 Large Pizza with Wings",description:"2 large pizza with 3 toppings, 48 wings and 4 pop",price:69,prices:[69]}]},{name:"Sunday to Wednesday Specials",items:[{name:"Large Pizza 3 Toppings",description:"",price:24.95,prices:[24.95]}]},{name:"Pizza",items:[{name:"Plain",description:"",price:12.75,prices:[12.75,18.75,24.25,29.25],sizes:["Small","Medium","Large","X-Large"]},{name:"One Topping",description:"",price:13,prices:[13,20.25,26,31.25],sizes:["Small","Medium","Large","X-Large"]},{name:"Two Toppings",description:"",price:14.5,prices:[14.5,21,27.5,32.25],sizes:["Small","Medium","Large","X-Large"]},{name:"Margherita Pizza",description:"Marinara, fresh mozzarella, fresh basil & virgin olive oil",price:15.75,prices:[15.75,22.25,30,35.75],sizes:["Small","Medium","Large","X-Large"]},{name:"Combination",description:"Mushrooms, pepperoni, green peppers",price:14.75,prices:[14.75,21.5,28,33.25],sizes:["Small","Medium","Large","X-Large"]},{name:"Combination with Green Olives",description:"Mushrooms, pepperoni, green peppers, olives",price:15.75,prices:[15.75,22.25,30,35.75],sizes:["Small","Medium","Large","X-Large"]},{name:"Canadian",description:"Pepperoni, mushrooms, bacon strips",price:16,prices:[16,24.25,31.5,37.75],sizes:["Small","Medium","Large","X-Large"]},{name:"Hawaiian",description:"Ham and pineapple",price:15,prices:[15,22.25,28.5,33.75],sizes:["Small","Medium","Large","X-Large"]},{name:"Hawaiian with Bacon Strips",description:"Ham, pineapple, bacon strips",price:16.5,prices:[16.5,23.25,31.5,37.75],sizes:["Small","Medium","Large","X-Large"]},{name:"Tony's Special",description:"Pepperoni, mushrooms, green peppers, olives and bacon strips",price:17,prices:[17,24.75,32.25,38.25],sizes:["Small","Medium","Large","X-Large"]},{name:"Meat Lovers",description:"Pepperoni, sausage, ham and bacon strips",price:16.75,prices:[16.75,24.5,31.75,38],sizes:["Small","Medium","Large","X-Large"]},{name:"Vegetarian",description:"Mushrooms, green peppers, olives, onions and tomatoes",price:16,prices:[16,24.5,31.75,37.75],sizes:["Small","Medium","Large","X-Large"]},{name:"Greek Pizza",description:"Black olives, red onions, tomatoes, hot peppers, feta and fresh herbs",price:17.5,prices:[17.5,26.75,32.25,39.25],sizes:["Small","Medium","Large","X-Large"]},{name:"Steak Pizza",description:"Tender steak, mushrooms, green peppers and onions",price:17.75,prices:[17.75,27.25,32.75,39.75],sizes:["Small","Medium","Large","X-Large"]},{name:"Lana's (Fajita)",description:"Chicken breast, onions, green peppers, black olives and hot peppers. Choice of homemade garlic sauce or pizza sauce",price:17.75,prices:[17.75,27.25,32.75,39.75],sizes:["Small","Medium","Large","X-Large"]},{name:"Chef Special",description:"Pepperoni, mushrooms, green peppers, olives, onions, tomatoes and bacon strips",price:17.75,prices:[17.75,27.25,32.75,39.75],sizes:["Small","Medium","Large","X-Large"]}]},{name:"Drinks",items:[{name:"Jusus Fresh Cocktail Juice",description:"473 ml",price:3.5,prices:[3.5]},{name:"Jusus Fresh Orange Juice",description:"473 ml",price:3.5,prices:[3.5]},{name:"Jusus Fresh Mango Juice",description:"473 ml",price:3.5,prices:[3.5]},{name:"Jusus Fresh Pineapple Juice",description:"473 ml",price:3.5,prices:[3.5]},{name:"Jusus Fresh Guava Juice",description:"473 ml",price:3.5,prices:[3.5]},{name:"Jusus Fresh Strawberry Banana Juice",description:"473 ml",price:3.5,prices:[3.5]},{name:"Coke",description:"",price:2.5,prices:[2.5,3.25,4,5.25],sizes:["Can","500ml bottle","710 ml","2 L"]},{name:"Pepsi",description:"",price:2.5,prices:[2.5,3.5,4,5.25],sizes:["Can","591ml bottle","710 ml","2 L"]},{name:"Diet Coke",description:"",price:2.5,prices:[2.5,3.25,4,5.25],sizes:["Can","500ml bottle","710 ml","2 L"]},{name:"Diet Pepsi",description:"",price:2.5,prices:[2.5,3.5,4,5.25],sizes:["Can","591ml bottle","710 ml","2 L"]},{name:"7 Up",description:"",price:2.5,prices:[2.5,3.5],sizes:["Can","591ml bottle"]},{name:"Ginger Ale",description:"",price:2.5,prices:[2.5,3.5,4],sizes:["Can","591ml bottle","710 ml"]},{name:"Water",description:"",price:2.5,prices:[2.5]}]}]};async function scrapeTonysPizza(e){return console.log(`🍕 Using Tony's Pizza specialized scraper for: ${e}`),{restaurant:{name:"Tony's Pizza",phone:"(613) 830-3276",address:"7772 Jeanne d'Arc Blvd, Ottawa, ON K1C 2R5",cuisine:"Pizza",website:e},categories:p.categories,scraped_at:new Date().toISOString(),source_url:e}}async function scrapeLegacyPlatform(e){console.log(`🕷️ Using general legacy platform scraper for: ${e}`);try{return{restaurant:{name:"Legacy Restaurant",phone:"",address:"",cuisine:"Restaurant",website:e},categories:[{name:"Menu Items",items:[{name:"Sample Item",description:"Sample menu item from legacy platform",price:10.99,prices:[10.99]}]}],scraped_at:new Date().toISOString(),source_url:e}}catch(e){throw console.error("Legacy scraping failed:",e),e}}async function scrapeMenu(e){return e.includes("tonys-pizza.ca")?await scrapeTonysPizza(e):await scrapeLegacyPlatform(e)}let m=(0,o.createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,(process.env.SUPABASE_SERVICE_ROLE_KEY||"").replace(/\s/g,"")),l={restaurant:{name:"Xtreme Pizza Ottawa",cuisine:"Pizza",location:"Ottawa, ON"},categories:[{name:"Appetizers",items:[{name:"Xtreme Platter",description:"Comes with zucchini, chicken fingers, onion rings, fries and breaded shrimps.",prices:[19.99]},{name:"Cheese Sticks",description:"8 Pcs",prices:[12.99]},{name:"Jalapeno Slammers",description:"6 Pcs",prices:[13.99]},{name:"Garlic Bread",description:"Regular",prices:[6.99,7.99,8.99],sizes:["Regular","With Cheese","With Cheese and Bacon"]},{name:"Nachos",description:"Comes with green peppers, onions and green olives.",prices:[16.99]},{name:"Fries",description:"",prices:[6.99,8.99],sizes:["Small","Large"]}]},{name:"Pizza",items:[{name:"Plain Pizza",description:"",prices:[13.99,19.99,25.99,31.99],sizes:["Small","Medium","Large","X-Large"]},{name:"Margherita",description:"Fresh mozzarella, tomatoes, basil",prices:[15.99,22.99,29.99,36.99],sizes:["Small","Medium","Large","X-Large"]},{name:"Hawaiian",description:"Ham, pineapple",prices:[15.99,22.99,29.99,36.99],sizes:["Small","Medium","Large","X-Large"]},{name:"Canadian",description:"Pepperoni, mushrooms, bacon strips",prices:[16.99,24.49,31.99,39.49],sizes:["Small","Medium","Large","X-Large"]},{name:"Meat Lovers",description:"Pepperoni, ham, sausage, bacon strips",prices:[17.99,25.99,33.99,41.99],sizes:["Small","Medium","Large","X-Large"]},{name:"House Special Pizza",description:"Pepperoni, mushrooms, green peppers, onions, green olives, bacon strips",prices:[18.99,27.49,35.99,43.49],sizes:["Small","Medium","Large","X-Large"]}]},{name:"Wings",items:[{name:"Chicken Wings",description:"Served with choice of red hot, sweet heat, honey garlic, mild, medium, suicide sauce",prices:[14.99,27.99,36.99],sizes:["10 Pcs","20 Pcs","30 Pcs"]},{name:"Boneless Dippers",description:"Served with choice of sauces",prices:[16.99,29.99,38.99],sizes:["10 Pcs","20 Pcs","30 Pcs"]}]},{name:"Poutine",items:[{name:"Poutine",description:"With cheese curds and gravy",prices:[8.99,11.99],sizes:["Small","Large"]},{name:"Italian Poutine",description:"With mozzarella cheese and meat sauce",prices:[9.99,12.99],sizes:["Small","Large"]},{name:"Canadian Poutine",description:"Cheese curds, chicken, bacon and gravy",prices:[10.99,13.99],sizes:["Small","Large"]}]},{name:"Salads",items:[{name:"Garden Salad",description:"Lettuce, tomatoes, onions, green peppers and green olives",prices:[9.99,12.99],sizes:["Small","Large"]},{name:"Greek Salad",description:"Lettuce, tomatoes, onions, green peppers, black olives and feta cheese",prices:[12.99,15.99],sizes:["Small","Large"]},{name:"Caesar Salad",description:"Lettuce, croutons and bacon bits",prices:[10.99,13.99],sizes:["Small","Large"]},{name:"Chicken Caesar Salad",description:"Chicken breast, lettuce, croutons and bacon bits",prices:[13.99,16.99],sizes:["Small","Large"]}]},{name:"Pasta",items:[{name:"Spaghetti",description:"With meat sauce. Served with garlic bread.",prices:[14.99]},{name:"Lasagna",description:"Served with garlic bread.",prices:[15.99]},{name:"Chicken Parmigiana",description:"Served with garlic bread.",prices:[19.99]}]},{name:"Drinks",items:[{name:"Pepsi",description:"",prices:[1.5,2.99,4.5],sizes:["Can","591ml","2L"]},{name:"Diet Pepsi",description:"",prices:[1.5,2.99,4.5],sizes:["Can","591ml","2L"]},{name:"7 Up",description:"",prices:[1.5,2.99,4.5],sizes:["Can","591ml","2L"]}]}]};async function handler(e,i){if("POST"!==e.method)return i.status(405).json({success:!1,error:"Method not allowed"});try{let s;let{url:r,restaurant_id:a,restaurant_name:n}=e.body;if(!r||!a)return i.status(400).json({success:!1,error:"URL and restaurant_id are required"});console.log("\uD83D\uDD0D Importing menu from:",r),console.log("\uD83C\uDFEA For restaurant:",n);try{console.log("\uD83D\uDD0D Attempting to scrape menu from URL...");let e=await scrapeMenu(r);s=e,console.log(`✅ Scraped ${e.categories.length} categories with ${e.categories.reduce((e,i)=>e+i.items.length,0)} items`)}catch(e){console.warn("⚠️ Scraping failed, falling back to Xtreme Pizza data:",e.message),s=l}console.log(`📊 Using ${s.categories.length} categories`);let t=(0,c.v4)();console.log("\uD83D\uDCCA Step 1: Creating restaurant menu...");let{data:o,error:p}=await m.from("restaurant_menus").insert({id:t,restaurant_id:a,tenant_id:"default-tenant",name:"Main Menu",description:`Complete menu imported from ${r}`,is_active:!0,display_order:1}).select().single();if(p||!o)return console.error("❌ Menu creation error:",JSON.stringify(p,null,2)),i.status(500).json({success:!1,error:"Failed to create restaurant menu",details:p});console.log("✅ Created restaurant menu:",o.id),console.log("\uD83D\uDCCA Step 2: Creating categories and items...");let d=0;for(let e=0;e<s.categories.length;e++){let i=s.categories[e],r=(0,c.v4)(),{data:a,error:n}=await m.from("menu_categories").insert({id:r,menu_id:o.id,name:i.name,description:`${i.name} selection`,display_order:e,is_active:!0}).select().single();if(n||!a){console.error(`❌ Category creation error for ${i.name}:`,JSON.stringify(n,null,2));continue}console.log(`✅ Created category: ${i.name} with ID: ${a.id}`),console.log(`📦 Creating ${i.items.length} items for category: ${i.name}`);for(let e=0;e<i.items.length;e++){let s=i.items[e],r=Array.isArray(s.prices)?s.prices[0]:s.prices,n=(0,c.v4)();console.log(`🔍 Attempting to create item: ${s.name} (${e+1}/${i.items.length})`),console.log(`📊 Item data: category_id=${a.id}, price=${r}, description="${s.description||""}"`);let t={id:n,category_id:a.id,name:s.name,description:s.description||"",price:r||0};console.log(`🚀 Inserting item with data:`,JSON.stringify(t,null,2));let{data:o,error:p}=await m.from("menu_items").insert(t).select().single();p?(console.error(`❌ Item creation error for ${s.name}:`,JSON.stringify(p,null,2)),console.error(`❌ Failed item data was:`,JSON.stringify(t,null,2)),console.error(`❌ Category ID used: ${a.id}`),console.error(`❌ Menu ID in category: ${a.menu_id}`)):(console.log(`✅ Created item: ${s.name} - $${r} (ID: ${o?.id})`),d++)}}return console.log(`✅ Menu import completed: ${d} items created`),i.status(200).json({success:!0,categories:s.categories.length,items:d,restaurant_id:a,preview:s.categories.slice(0,5).map(e=>({name:e.name,items:e.items.length})),message:`Successfully imported ${d} menu items across ${s.categories.length} categories`})}catch(e){return console.error("Menu import error:",e),i.status(500).json({success:!1,error:"Failed to import menu",message:e instanceof Error?e.message:"Unknown error"})}}let d=(0,t.l)(r,"default"),g=(0,t.l)(r,"config"),u=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/admin/import-legacy-menu",pathname:"/api/admin/import-legacy-menu",bundlePath:"",filename:""},userland:r})}};var i=require("../../../webpack-api-runtime.js");i.C(e);var __webpack_exec__=e=>i(i.s=e),s=i.X(0,[222],()=>__webpack_exec__(6932));module.exports=s})();